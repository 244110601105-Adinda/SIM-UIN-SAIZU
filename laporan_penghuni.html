<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laporan Penghuni | SIM Asrama UIN Saizu</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body { display:flex; background-color:#f5f8f7; min-height:100vh; overflow-x:hidden; }

    /* SIDEBAR */
    .sidebar {
      position: fixed;
      top: 0; left: 0;
      width: 250px;
      height: 100vh;
      background-color: #007e5a;
      color: white;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 8px rgba(0,0,0,0.15);
      transition: left 0.3s ease;
      z-index: 1000;
    }
    .sidebar.collapsed { left: -250px; }
    .sidebar h2 { text-align: center; padding: 25px; background-color: #009b72; font-size: 18px; font-weight: 600; }
    .sidebar ul { list-style: none; margin-top: 10px; padding-left: 0; }
    .sidebar ul li { padding: 14px 25px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
    .sidebar ul li:hover, .sidebar ul li.active { background-color: #00b985; }
    .sidebar ul li a { text-decoration: none; color: white; display: flex; align-items: center; width: 100%; gap: 10px; }
    .logout-btn { background: none; color: white; border: 1px solid white; padding: 10px 25px; border-radius: 25px; font-size: 14px; cursor: pointer; margin: 30px auto; width: 80%; transition: 0.3s; }
    .logout-btn:hover { background: white; color: #007e5a; }
    /* MAIN */
    .main-content {
      margin-left:250px;
      flex-grow:1;
      padding:30px 40px;
      transition:margin-left 0.3s ease, width 0.3s ease;
      width:calc(100% - 250px);
    }
    .main-content.fullscreen { margin-left:0; width:100%; }

    /* TOP BAR */
    .top-bar {
      display:flex; align-items:center; justify-content:space-between;
      background:white; padding:10px 20px; border-radius:16px;
      margin-bottom:30px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    .top-left { display:flex; align-items:center; gap:10px; }
    .hamburger-card {
      width:50px; height:50px; border-radius:12px;
      background:#e6f7ef; display:flex; align-items:center; justify-content:center; cursor:pointer;
    }
    .hamburger-card i { font-size:22px; color:#006d55; }
    .top-title { font-size:22px; color:#007e5a; font-weight:600; }
    .user-card { display:flex; align-items:center; gap:10px; background:#e6f7ef; padding:6px 15px; border-radius:30px; }
    .user-card img { width:36px; height:36px; border-radius:50%; }
    .user-card span { color:#007e5a; font-weight:500; }

    /* FORM */
    .container-box {
      background:white;
      border-radius:16px;
      padding:25px;
      box-shadow:0 4px 10px rgba(0,0,0,0.08);
    }
    label { display:block; margin:12px 0 6px; color:#006d55; font-weight:500; }
    input, select, textarea {
      width:100%; padding:12px; border-radius:10px;
      border:1px solid #cbd5d1; outline:none;
    }
    textarea { min-height:120px; resize:vertical; }
    button {
      width:100%; padding:12px; background:#007e5a;
      color:white; border:none; border-radius:10px;
      font-size:16px; margin-top:18px; cursor:pointer;
      transition:0.3s;
    }
    button:hover { background:#009b72; }
    .success {
      display:none; margin-top:15px; padding:12px;
      border-radius:10px; background:#e8fff2;
      border-left:5px solid #00b985;
      color:#006d55;
    }
    
    /* Preview Foto */
    .preview-container {
      margin-top:10px;
      display:none;
    }
    .preview-image {
      max-width:100%;
      max-height:200px;
      border-radius:10px;
      margin-top:10px;
      border:1px solid #cbd5d1;
    }
    .remove-photo {
      background:#f8d7da;
      color:#721c24;
      border:none;
      padding:5px 10px;
      border-radius:5px;
      cursor:pointer;
      font-size:12px;
      margin-top:5px;
    }
    
    /* Status Laporan */
    .status-info {
      background:#e7f1ff;
      padding:15px;
      border-radius:10px;
      margin-bottom:20px;
      border-left:5px solid #006d55;
    }
    
    /* Responsif */
    @media (max-width: 768px) {
      .main-content {
        margin-left:0;
        width:100%;
        padding:20px;
      }
      .sidebar {
        left:-250px;
      }
      .sidebar.collapsed {
        left:0;
      }
    }

  </style>
</head>
<body>

  <!-- SIDEBAR -->
    <aside class="sidebar">
    <h2><i class="fa-solid fa-building-columns"></i> Penghuni Asrama</h2>
    <ul>
      <li><a href="dashboard_user.html"><i class="fa-solid fa-house"></i> Dashboard</a></li>
      <li><a href="profil.html"><i class="fa-solid fa-id-card"></i> Profil Saya</a></li>
      <li><a href="pembayaran.html"><i class="fa-solid fa-wallet"></i> Pembayaran</a></li>
      <li><a href="jadwaluser.html"><i class="fa-solid fa-calendar-days"></i> Jadwal Kegiatan</a></li>
      <li><a href="riwayat.html"><i class="fa-solid fa-clock-rotate-left"></i> Riwayat</a></li>
    </ul>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </aside>
  <!-- MAIN CONTENT -->
  <main class="main-content" id="mainContent">

    <div class="top-bar">
      <div class="top-left">
        <div class="hamburger-card" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
        <div class="top-title">Laporan Penghuni</div>
      </div>
      <div class="user-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User">
        <span id="username">Loading...</span>
      </div>
    </div>

    <div class="status-info">
      <h3><i class="fa-solid fa-circle-info"></i> Informasi Laporan</h3>
      <p>Gunakan form ini untuk melaporkan masalah yang Anda temukan di asrama. Laporan akan diproses oleh petugas asrama dalam waktu 1-3 hari kerja.</p>
    </div>

    <div class="container-box">
      <label for="kategori">Kategori Laporan <span style="color:#ff0000">*</span></label>
      <select id="kategori">
        <option value="">-- Pilih Kategori --</option>
        <option value="Kerusakan Fasilitas">Kerusakan Fasilitas</option>
        <option value="Kebersihan">Kebersihan</option>
        <option value="Keamanan">Keamanan</option>
        <option value="Lainnya">Lainnya</option>
      </select>

      <label for="judul">Judul Laporan <span style="color:#ff0000">*</span></label>
      <input type="text" id="judul" placeholder="Contoh: Lampu kamar mati">

      <label for="deskripsi">Deskripsi Laporan <span style="color:#ff0000">*</span></label>
      <textarea id="deskripsi" placeholder="Jelaskan masalah yang terjadi secara detail..."></textarea>

      <label for="foto">Foto Pendukung (Opsional)</label>
      <input type="file" id="foto" accept="image/*" onchange="previewFoto(event)">
      
      <div class="preview-container" id="previewContainer">
        <p>Preview Foto:</p>
        <img id="previewImage" class="preview-image" src="#" alt="Preview Foto">
        <button type="button" class="remove-photo" onclick="removeFoto()">Hapus Foto</button>
      </div>

      <button onclick="kirimLaporan()"><i class="fa-solid fa-paper-plane"></i> Kirim Laporan</button>
      <div id="notif" class="success">Laporan berhasil dikirim!</div>
    </div>

  </main>

<script>
  // Inisialisasi data
  document.addEventListener("DOMContentLoaded", function() {
    // Ambil username dari localStorage
    document.getElementById("username").innerText = localStorage.getItem("username") || "Penghuni";
    
    // Load data laporan sebelumnya jika ada
    loadRiwayatLaporan();
  });

  function logout() { 
    if(confirm("Yakin ingin keluar?")) { 
      window.location.href = "index.html"; 
    } 
  }

  function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    const main = document.getElementById("mainContent");
    sidebar.classList.toggle("collapsed");
    main.classList.toggle("fullscreen");
  }

  function previewFoto(event) {
    const input = event.target;
    const previewContainer = document.getElementById("previewContainer");
    const previewImage = document.getElementById("previewImage");
    
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        previewImage.src = e.target.result;
        previewContainer.style.display = "block";
      }
      
      reader.readAsDataURL(input.files[0]);
    }
  }

  function removeFoto() {
    document.getElementById("foto").value = "";
    document.getElementById("previewContainer").style.display = "none";
    document.getElementById("previewImage").src = "#";
  }

  function kirimLaporan() {
    let kategori = document.getElementById("kategori").value;
    let judul = document.getElementById("judul").value;
    let deskripsi = document.getElementById("deskripsi").value;
    let fotoInput = document.getElementById("foto");
    
    // Validasi form
    if(kategori.trim() === "") {
      alert("Kategori laporan wajib dipilih!");
      return;
    }
    
    if(judul.trim() === "") {
      alert("Judul laporan wajib diisi!");
      return;
    }
    
    if(deskripsi.trim() === "") {
      alert("Deskripsi laporan wajib diisi!");
      return;
    }
    
    // Ambil data pengguna
    let username = localStorage.getItem("username") || "Penghuni";
    let userId = localStorage.getItem("userId") || "user001";
    
    // Buat objek laporan
    let laporan = {
      id: Date.now(), // ID unik berdasarkan timestamp
      kategori: kategori,
      judul: judul,
      deskripsi: deskripsi,
      tanggal: new Date().toLocaleString('id-ID'),
      status: "Menunggu",
      userId: userId,
      username: username,
      foto: null
    };
    
    // Simpan foto jika ada (dalam bentuk base64 untuk simulasi)
    if (fotoInput.files && fotoInput.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        laporan.foto = e.target.result;
        simpanLaporan(laporan);
      };
      reader.readAsDataURL(fotoInput.files[0]);
    } else {
      simpanLaporan(laporan);
    }
  }

  function simpanLaporan(laporan) {
    // Ambil data laporan yang sudah ada dari localStorage
    let semuaLaporan = JSON.parse(localStorage.getItem("laporanPenghuni")) || [];
    
    // Tambahkan laporan baru
    semuaLaporan.push(laporan);
    
    // Simpan kembali ke localStorage
    localStorage.setItem("laporanPenghuni", JSON.stringify(semuaLaporan));
    
    // Tampilkan notifikasi sukses
    const notif = document.getElementById("notif");
    notif.style.display = "block";
    notif.innerHTML = `<i class="fa-solid fa-circle-check"></i> Laporan berhasil dikirim! ID Laporan: ${laporan.id}`;
    
    // Reset form
    document.getElementById("kategori").value = "";
    document.getElementById("judul").value = "";
    document.getElementById("deskripsi").value = "";
    removeFoto();
    
    // Sembunyikan notifikasi setelah 5 detik
    setTimeout(() => {
      notif.style.display = "none";
    }, 5000);
    
    // Tambahkan ke riwayat laporan
    loadRiwayatLaporan();
  }

  function loadRiwayatLaporan() {
    // Fungsi ini bisa digunakan untuk menampilkan riwayat laporan
    // atau mengirim data ke halaman riwayat jika diperlukan
    console.log("Riwayat laporan telah diperbarui");
  }

</script>
</body>
</html>
